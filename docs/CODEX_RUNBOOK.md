# ChatriX — Runbook по работе с Codex

Цель: заставить Codex работать по репозиторию **без остановок**, делая маленькие завершённые изменения с тестами.

## 1) Что вы отдаёте Codex одним сообщением
1) Первым сообщением отправьте Codex целиком содержимое файла:
- `docs/CODEX_PROMPT.md`

2) Вторым сообщением (если просит контекст) добавьте:
- `docs/TZ.md`

3) Третьим сообщением (если нужно) добавьте:
- `codex/WORK_PLAN.md`

Правило: если Codex начинает «фантазировать» требования — остановите и напомните: **SOURCE OF TRUTH = docs/TZ.md**.

## 2) Как ставить задачи (правильные команды)
Используйте короткие, проверяемые формулировки:
- «Выполни Milestone 1 из codex/WORK_PLAN.md. Сделай PR-изменения: миграции, тесты, эндпойнты, минимальный UI-экран. Прогони pytest.»
- «Добавь таблицы plans/plan_limits/referral_tiers и миграции. Напиши тесты на чтение конфигов.»

## 3) Контроль качества
После каждого шага требуйте от Codex:
- список изменённых файлов;
- команду запуска;
- результат тестов;
- обновление `codex/WORK_PLAN.md`.

Минимальные проверки:
- Backend:
  - `docker compose up --build`
  - `pytest` (внутри backend контейнера или локально)
- Статика:
  - линтер/форматтер по выбору Codex (зафиксировать в `docs/DECISIONS.md`).

## 4) Стратегия, чтобы Codex не «зависал» и не расползался
- Дробите работу: 1 фича = 1 PR.
- Сначала backend контракты (эндпойнты + БД + тесты), затем mobile UI.
- Любые допущения фиксируются в `docs/DECISIONS.md`.
- Все тарифы/проценты/цены — только из конфигов БД, не из хардкода.

## 5) Где в репозитории лежит документация
- ТЗ: `docs/TZ.md`
- Боевой промт: `docs/CODEX_PROMPT.md`
- Runbook: `docs/CODEX_RUNBOOK.md`
- Бриф раздела: `docs/SECTION_BRIEF_TEMPLATE.md`

## 6) Быстрый запуск каркаса (dev)
### Backend + Postgres
```bash
cp backend/.env.example backend/.env
docker compose up --build
```
Откройте Swagger: `http://localhost:8000/docs`

### Mobile (Flutter)
Файл-заглушка: `mobile/lib/main.dart`.
Рекомендуемо: создать полный Flutter-проект командой `flutter create`, затем перенести `lib/` и подключить зависимости.
